<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UWC Immersive Zone - Login</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <?!= include('LoginStylesheet'); ?>
</head>
<body>
  <!-- Login Page -->
  <div class="login-page">
    <!-- Left Branding Panel -->
    <div class="login-brand">
      <div class="login-brand-content">
        <img src="https://innovationhub.uwc.ac.za/img/UIH_Logo_FA.png" alt="UWC Immersive Zone" class="login-logo">
        <h1 class="login-brand-title">Analytics Dashboard</h1>
        <p class="login-brand-subtitle">Track engagement and performance metrics for UWC Immersive Zone educational experiences.</p>
        <div class="login-brand-features">
          <div class="login-feature">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
            </svg>
            <span>Real-time Analytics</span>
          </div>
          <div class="login-feature">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            <span>User Engagement</span>
          </div>
          <div class="login-feature">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            <span>PDF Reports</span>
          </div>
        </div>
      </div>
      <div class="login-brand-footer">
        <p>University of the Western Cape</p>
        <p>UWC Immersive Zone</p>
      </div>
    </div>

    <!-- Right Login Panel -->
    <div class="login-panel">
      <div class="login-form-container">
        <!-- Step 1: Email -->
        <div id="loginStep1" class="login-step active">
          <div class="login-step-header">
            <h2>Sign In</h2>
            <p>Enter your registered email to access the Analytics Dashboard.</p>
          </div>
          <form id="emailForm" onsubmit="return false;">
            <div class="login-input-group">
              <label for="emailInput">Email Address</label>
              <div class="login-input-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="login-input-icon">
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                  <polyline points="22,6 12,13 2,6"/>
                </svg>
                <input type="email" id="emailInput" placeholder="name@uwc.ac.za" autocomplete="email" required>
              </div>
            </div>
            <div id="emailError" class="login-error" style="display:none;"></div>
            <button type="submit" id="emailBtn" class="login-btn" onclick="handleEmailSubmit()">
              <span class="login-btn-text">Continue</span>
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="login-btn-icon">
                <line x1="5" y1="12" x2="19" y2="12"/>
                <polyline points="12 5 19 12 12 19"/>
              </svg>
            </button>
          </form>
        </div>

        <!-- Step 2: Verification Code -->
        <div id="loginStep2" class="login-step">
          <div class="login-step-header">
            <h2>Verify Code</h2>
            <p>We sent a 5-digit code to <strong id="sentEmailDisplay"></strong></p>
          </div>
          <form id="codeForm" onsubmit="return false;">
            <div class="login-input-group">
              <label for="codeInput">Verification Code</label>
              <div class="login-input-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="login-input-icon">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <input type="text" id="codeInput" placeholder="XXXXX" maxlength="5" autocomplete="one-time-code" required style="letter-spacing: 6px; font-size: 1.3rem; font-weight: 700; text-align: center;">
              </div>
            </div>
            <div id="codeError" class="login-error" style="display:none;"></div>
            <button type="submit" id="codeBtn" class="login-btn" onclick="handleCodeSubmit()">
              <span class="login-btn-text">Verify & Sign In</span>
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="login-btn-icon">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
            </button>
            <div class="login-secondary-actions">
              <button type="button" class="login-link-btn" onclick="resendCode()">Resend Code</button>
              <button type="button" class="login-link-btn" onclick="goBackToEmail()">Use different email</button>
            </div>
          </form>
        </div>

        <!-- Step 3: Success (brief) -->
        <div id="loginStep3" class="login-step">
          <div class="login-success">
            <div class="login-success-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
              </svg>
            </div>
            <h2>Welcome, <span id="welcomeName"></span></h2>
            <p>Redirecting to Analytics Dashboard...</p>
            <div class="login-progress-bar">
              <div class="login-progress-fill"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <?!= include('LoginJavaScript'); ?>
</body>
</html>
